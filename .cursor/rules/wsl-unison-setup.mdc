---
alwaysApply: false
---
# Development Environment Setup - WSL/Unison Sync

This project uses a dual-filesystem setup for development:

## File Locations

- **Linux/WSL location** (primary development location):
  `/home/william/not_connected_to_windows/CalendarNotification`

- **Windows location** (accessible via WSL at `/mnt/c`):
  `/mnt/c/Users/william/unison-with-dropbox-symlinked-to-linux/CalendarNotification`

## Sync Strategy

- **Unison** is used to sync files between the Linux and Windows filesystems
- Most files are synced, but **`node_modules` is NOT synced** due to size
- `node_modules` is installed separately on each side of the sync

## Implications

- When referencing paths, prefer the Linux location (`/home/william/not_connected_to_windows/CalendarNotification`)
- If `node_modules` appears missing or incomplete, it may need to be installed separately on that side
- Git operations and file system operations are faster on the Linux side
- Windows Android Studio builds must use the Windows-synced location
- File system permission issues may occur when accessing Windows files from Linux and vice versus (hence keeping them separate)

## Windows Long Path Issue (New Architecture)

React Native's New Architecture codegen creates very long file paths that can exceed Windows' 260-character limit. The long project path (`unison-with-dropbox-symlinked-to-linux`) makes this worse.

**Workaround**: Use `subst` to create a short drive letter alias:

```cmd
subst X: "C:\Users\william\unison-with-dropbox-symlinked-to-linux\CalendarNotification"
```

Then build from `X:\android` instead. This shortens paths significantly and avoids the ninja build errors like:
```
ninja: error: Stat(...): Filename longer than 260 characters
```

**Important**: The `subst` drive is only visible at the same elevation level where it was created. If you run `subst` from a non-Admin command prompt, you must use non-Admin Explorer/terminals to see the `X:` drive. Running as Admin won't see it (and vice versa).

To remove the substitution later:
```cmd
subst X: /d
```

## NativeWind ESM Issue (Metro on Windows)

NativeWind v4 has a known issue where Metro cannot load the config on Windows due to ESM path handling. This causes errors like:
```
Error [ERR_UNSUPPORTED_ESM_URL_SCHEME]: Only URLs with a scheme in: file, data, and node are supported by the default ESM loader. On Windows, absolute paths must be valid file:// URLs. Received protocol 'c:'
```

**Workaround**: Pre-bundle on WSL, then build on Windows.

1. **Pre-bundle on WSL** (when JS/CSS changes):
   ```bash
   cd /home/william/not_connected_to_windows/CalendarNotification
   yarn bundle:android --dev=true
   ```

2. **Build on Windows** (uses pre-built bundle):
   ```powershell
   cd X:\android
   .\gradlew assembleDebug
   ```

The `scripts/bundle_or_skip.js` wrapper automatically detects and copies the pre-built bundle, skipping Metro on Windows. This is configured via `cliFile` in `android/app/build.gradle`.

See: https://github.com/nativewind/nativewind/issues/1667
