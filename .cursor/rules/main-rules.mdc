---
description: 
globs: 
alwaysApply: true
---


# Code Changes

This is a legacy codebase (2016) with a robust test suite added in 2024-25.

**Permitted without confirmation:**
- Bug fixes with corresponding test coverage
- Refactoring with existing test coverage
- Removal of deprecated features (QuietHours, CalendarEditor)

**Requires tests first:**
- New features or significant changes

When in doubt, add tests first.


# Faithful Testing

Mock only what you must - core Android APIs that instrumentation tests can't handle (e.g., push notifications). Use real code for anything in this codebase.


# Incremental Changes

Minimum viable solution first, then build on top. Break things into small testable pieces.

**No cheating:** Don't comment out or skip tests to solve a problem (temporary bandaids excepted).

# Keep Code Concise

Everything it needs, nothing it doesn't. Every new line of code is one that potentially doesn't work ðŸ˜„


# Check Documentation First

See `docs/README.md` for the full documentation index.

**Key references:**

- `docs/dev_completed/constructor-mocking-android.md` - **MockK limitations**: `mockkStatic`, `mockkConstructor`, and `anyConstructed` almost always fail in Android instrumentation tests. Use dependency injection patterns instead.

- `docs/architecture/calendar_monitoring.md` - Deep detail on how calendar monitoring works (EVENT_REMINDER broadcasts, manual rescans, etc.)

- `docs/architecture/clock_implementation.md` - How `CNPlusClockInterface` enables testable time-dependent code


# Copyright Headers

For new or updated copyright headers, use:

```
Copyright (C) 2025 William Harris (wharris+cnplus@upscalews.com)
```

(William inherited the application from Sergey Parshin in 2020)